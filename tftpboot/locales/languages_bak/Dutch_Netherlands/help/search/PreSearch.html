<html><head>
<TITLE></TITLE>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
</head>
<BODY BGCOLOR="#FFFFFF" onLoad=this.document.everything.USERTEXT.focus()>

<script language="Javascript" type="text/javascript">
<!-- // START OF SEARCH SCRIPT


function getUrlValue(valname)
  {
  var locat = window.location.toString();
  var ind = locat.search(/\?/i);
  if (ind != -1)
    {
    locat = locat.substr(ind + 1);

    var re = new RegExp(valname + "=", "i");  
    if ((ind = locat.search(re)) != -1)
      {
      locat = locat.substr(ind + valname.length + 1);
      if ((ind = locat.search(/\&/i)) != -1)
        locat = locat.substr(0, ind);
        
      locat = locat.replace(/\+/gi, " ").replace(/\%2B/gi, "+");
      return locat;
      }
    else
      return "";
    
    }
  else
    return "";
  }

NS4 = (window.navigator.appName == "Netscape") ? true : false;

// set event listener for when user presses <ENTER> 
if (NS4) {
	window.captureEvents(Event.KEYPRESS);
	window.onKeyPress = checkEnter;
}

// event handler to process a search request
function checkEnter(event)
{ 
	var code = 0;
	
	if (NS4){code = event.which;}
	else{code = event.keyCode;}
	if (code==13) {
		doser();
//		document.everything.submit();
	}
}

// prepares the search string for the search engine
function doser() {
	top.searchText=document.everything.USERTEXT.value;
	top.searchType=document.everything.BooleanType.value;
	if (top.searchType == null) {
    		var optIndex = document.everything.BooleanType.selectedIndex;
    		if (optIndex == -1) optIndex = 0;
    		top.searchType = document.everything.BooleanType.options[optIndex].value;
	}
	cleanInput();
}

// Function will ensure that all characters in the search string are recognizable.
function cleanInput() {
	
	//if the search string is all spaces, do not do a search
	var ind = 0;
	while (ind < top.searchText.length && 
		(top.searchText.charAt(ind) == ' ' || top.searchText.charCodeAt(ind) == 12288)) {
		ind++;
	}
	if (ind == top.searchText.length)
		top.searchText = "";
	else if (ind > 0)
		top.searchText = top.searchText.substring(ind);
	ind = top.searchText.length-1;
	while (ind > -1 && 
		(top.searchText.charAt(ind) == ' ' || top.searchText.charCodeAt(ind) == 12288)) {
		ind--;
	}
	if (ind == -1)
		top.searchText = "";
	else if (ind < top.searchText.length-1);
		top.searchText = top.searchText.substring(0,ind+1);

	if (top.searchText.length > 0) {

		cleanISOInput();

		if (top.charsetEncoding == "shift_jis" 
		 || top.charseteEncoding == "big5"
		 || top.charsetEncoding == "gb3212"
		 || top.charsetEncoding == "euc_kr"
		 || top.charsetEncoding == undefined) 
			cleanCKJVInput();
		
		//get rid of repeated spaces
		top.searchText = top.searchText.replace(/[ ]+/g," ");
		top.searchText = top.searchText.replace(/\"/g,"'");
	}
}

//deals with ascii representation of letters and symbols
function cleanISOInput() {

	//get rid of repeated spaces
	top.searchText = top.searchText.replace(/[ ]+/g," ");

	//remove symbols from beginning and end of words 
	top.searchText = top.searchText.replace(/[~!@#$%^&*\(\)_+`\-=\{\}|\[\]\\:\";'<>?,.\/]+ /gi," ");	
	top.searchText = top.searchText.replace(/ [~!@#$%^&*\(\)_+`\-=\{\}|\[\]\\:\";'<>?,.\/]+/gi," ");	
	top.searchText = top.searchText.replace(/[~!@#$%^&*\(\)_+`\-=\{\}|\[\]\\:\";'<>?,.\/]+$|^[~!@#$%^&*\(\)_+`\-=\{\}|\[\]\\:\";'<>?,.\/]+/gi,"");

	//separate words containing '/', ':', '-', '[', or ']' into two words
	top.searchText = top.searchText.replace(/\b[\/:\-\[\]]\b/g," ");
	
	//remove parenthesis from words ending in (s) or (es)
	top.searchText = top.searchText.replace(/\(s\)$/gi,"s");
	top.searchText = top.searchText.replace(/\(s\) /gi,"s ");
	top.searchText = top.searchText.replace(/\(es\)$/gi,"es");
	top.searchText = top.searchText.replace(/\(es\) /gi,"es ");
}

// when document.charset == "shift_jis"
function cleanCKJVInput() {

	var i = 0;
	var currCharCode;
	
	//remove leading and trailing symbols
	while ((top.searchText.charCodeAt(i) > 65279 && top.searchText.charCodeAt(i) < 65520)
		|| (top.searchText.charCodeAt(i) > 12288 && top.searchText.charCodeAt(i) < 12302)
		|| top.searchText.charCodeAt(i) == 8216
		|| top.searchText.charCodeAt(i) == 8217
		|| top.searchText.charCodeAt(i) == 8221) {
		i++;	
	}
	if (i == top.searchText.length)
		top.searchText = "";
	else if (i > 0)
		top.searchText = top.searchText.substring(i);
	i = top.searchText.length-1;
	while ((top.searchText.charCodeAt(i) > 65279 && top.searchText.charCodeAt(i) < 65520)
		|| (top.searchText.charCodeAt(i) > 12288 && top.searchText.charCodeAt(i) < 12302)
		|| top.searchText.charCodeAt(i) == 8216
		|| top.searchText.charCodeAt(i) == 8217
		|| top.searchText.charCodeAt(i) == 8221) {
		i--;
	}
	if (i == -1)
		top.searchText = "";
	else if (i < top.searchText.length-1);
		top.searchText = top.searchText.substring(0,i+1);
	
	for (i=0; i<top.searchText.length-1; i++) {
		currCharCode = top.searchText.charCodeAt(i);				
		// replace full-width spaces with normal spaces
		if (currCharCode == 12288) {
			top.searchText = top.searchText.substring(0,i) 
						+ String.fromCharCode(32) 
						+ top.searchText.substring(i+1,top.searchText.length);
		}
	
		// add spaces between each japanese character
		else if ((currCharCode > 12351 && currCharCode < 12544)
			|| (currCharCode > 16621 && currCharCode < 40960)) {
				top.searchText = top.searchText.substring(0,i+1)
							+ String.fromCharCode(32)
							+ top.searchText.substring(i+1,top.searchText.length);
		}
	}
}

function debug() {
top.s = "Length of searchText: "+top.searchText.length+".\n";
	for (var i=0; i< top.searchText.length; i++) {
		top.s += "Char ";
		top.s += i;
		top.s += ": ";
		top.s += top.searchText.charAt(i);
		top.s += ". CharCode: ";
		top.s += top.searchText.charCodeAt(i); 
		if (top.searchText.charCodeAt(i) == 12288) {
			top.s += ". This is a full-width space!";
		} 
		top.s += ".\n";
	}

	window.alert(top.s);

}

if (top.searchText  != "") {
	parent.print_search_results();
}
else {
 	parent.print_search_form();
}
  

// END OF SEARCH SCRIPT -->
</script>

</body></html>

